{% assign wh_v_compare_at_price = wh_variant.compare_at_price %}
{% if wh_v_compare_at_price == blank or wh_v_compare_at_price == 0  %}
  {% assign wh_v_compare_at_price = wh_variant.price %}
{% endif %}

{% assign wh_v_price = wh_v_compare_at_price | times: wh_discount_value %}
{% if wh_v_price > wh_variant.price  %}
  {% assign wh_v_price = wh_variant.price %}
{% endif %}


{% if v_discount_tag %}
  {% assign set_v_price = wh_variant.metafields.wh_discount[v_discount_tag] %}
  {% if set_v_price %}
    {% assign wh_v_price = set_v_price %}
  {% endif %}
{% endif %}

{% if wh_discount_value == 1 and set_v_price == null %}
  {% assign wh_v_compare_at_price = wh_variant.compare_at_price %}
  {% assign wh_v_price = wh_variant.price %}
{% endif %}

<!-- variant.compare_at_price{{wh_variant.compare_at_price}} : wh_v_compare_at_price {{wh_v_compare_at_price}} : set_v_price {{set_v_price}}-->
<!-- variant.price {{wh_variant.price}} : wh_v_price {{wh_v_price }} -->